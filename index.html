<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Untuk Liaaa üíñ</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/833/833472.png"/>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --pink:#ff8fb1; --pink-2:#ffb6c1; --pink-3:#ffe6f2; --text:#444; --rose:#ff6fa8;
      --shadow:0 6px 16px rgba(0,0,0,.15);
      --safe-bot: env(safe-area-inset-bottom);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; min-height:100vh; overflow-y:auto; -webkit-overflow-scrolling:touch;
      display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
      background:linear-gradient(180deg,#ffd6e8,#ffe6f2); color:var(--text);
      font-family:'Poppins',system-ui,sans-serif; text-align:center; position:relative; transition:background 1.5s ease;
      padding-bottom:calc(24px + var(--safe-bot));
    }
    h1{ font-family:'Great Vibes',cursive; font-size:32px; color:var(--rose); animation:glow 2s ease-in-out infinite alternate; position:relative; z-index:5; margin:10px 12px }
    @keyframes glow{from{text-shadow:0 0 10px #fff} to{text-shadow:0 0 25px #ffb6e0}}

    #bokeh{ position:fixed; inset:0; z-index:0; filter:blur(30px);
      background:
        radial-gradient(circle at 20% 30%, rgba(255,255,255,.35) 0%, transparent 70%),
        radial-gradient(circle at 80% 60%, rgba(255,200,220,.28) 0%, transparent 70%);
      animation:moveBokeh 10s ease-in-out infinite alternate
    }
    @keyframes moveBokeh{ from{transform:translateY(0)} to{transform:translateY(-40px)} }

    .wrap{ width:100%; max-width:720px; margin:18px auto; padding:0 14px; position:relative; z-index:1 }

    .btn{
      background:var(--pink); color:#fff; border:none; border-radius:12px; padding:14px 20px; font-weight:700; font-size:18px;
      box-shadow:var(--shadow); cursor:pointer; transition:transform .18s, background .18s; display:inline-block
    }
    .btn:hover{ transform:translateY(-2px); background:#ff73a6 }

    #startBtn{ margin-top:18vh }
    #message{ display:none; opacity:0; transition:opacity 1s ease; max-width:680px; margin:16px auto 0; padding:0 6px; line-height:1.7; color:#555; z-index:5; position:relative; word-break:break-word }
    #message span.sparkle{ position:absolute; font-size:16px; color:#ff9cc6; animation:sparkleFade 1.3s linear forwards }
    @keyframes sparkleFade{ 0%{opacity:1; transform:scale(.8) translateY(0)} 100%{opacity:0; transform:scale(1.6) translateY(-20px)} }

    .heart{
      position:fixed; bottom:-10px; width:18px; height:18px; background:pink; transform:rotate(45deg);
      animation:floatUp 6s linear forwards; z-index:1; pointer-events:none
    }
    .heart::before,.heart::after{ content:''; position:absolute; width:18px; height:18px; background:pink; border-radius:50% }
    .heart::before{ top:-9px; left:0 } .heart::after{ top:0; left:9px }
    @keyframes floatUp{ 0%{transform:translateY(0) rotate(45deg);opacity:1} 100%{transform:translateY(-110vh) rotate(45deg);opacity:0} }

    /* QUOTE BOX ‚Äî sekarang hanya muncul di AKHIR */
    #quoteBox{
      display:none; position:fixed; left:50%; top:10px; transform:translateX(-50%);
      background:rgba(255,255,255,.85); border:1px solid rgba(255,255,255,.9);
      padding:8px 12px; border-radius:999px; font-size:14px; color:#7a5c6d; z-index:6; opacity:0; transition:opacity .6s;
      max-width:92vw; box-shadow:var(--shadow); align-items:center; gap:8px
    }
    #quoteBoxInner{ display:flex; align-items:center; gap:8px }
    #quoteText{ white-space:normal }
    #quoteClose{ cursor:pointer; font-weight:800; padding:0 6px }

    /* Container pertanyaan agar tombol kabur tetap di dalam area */
    #loveQuestion{ display:none; opacity:0; transition:opacity 1s ease; margin-top:24px; z-index:5; position:relative; min-height:140px }
    #loveQuestion .btn{ margin:8px }
    .runner{ position:absolute }

    #fromText{ display:none; opacity:0; transition:opacity 1s ease; margin-top:16px; font-family:'Great Vibes',cursive; font-size:26px; color:#ff5c8a; z-index:5 }
    #hugBtn{ display:none; opacity:0; transition:opacity 1s ease; margin-top:18px; background:#ffc6d9 }

    /* POPUP tengah */
    #popup{
      display:none; position:fixed; inset:0; z-index:50; align-items:center; justify-content:center;
      background:rgba(255,200,230,.85); backdrop-filter:blur(4px); padding:24px; animation:fadeIn .8s ease
    }
    #popupInner{
      width:100%; max-width:480px; background:rgba(255,255,255,.9);
      border:1px solid #ffd1e2; border-radius:16px; padding:18px 16px;
      box-shadow:0 8px 26px rgba(0,0,0,.15); word-break:break-word
    }
    #popupInner h2{ font-family:'Great Vibes',cursive; font-size:40px; margin:0 0 6px; color:#ff6fa8; text-wrap:balance }
    #popupInner p{ margin:6px 0 0; font-size:18px; color:#a64b73 }
    @keyframes fadeIn{ from{opacity:0} to{opacity:1} }

    /* Amplop terbang */
    #envelope{
      display:none; position:fixed; bottom:20px; right:20px; z-index:4; font-size:28px; animation:flyUp 6s ease-in forwards
    }
    @keyframes flyUp{ to{ transform:translate(-40vw,-80vh); opacity:0 } }

    /* Music toggle */
    #musicBtn{
      position:fixed; right:16px; bottom:calc(16px + var(--safe-bot));
      width:52px; height:52px; border-radius:50%; border:none; background:var(--pink-2); color:#fff;
      font-size:22px; box-shadow:var(--shadow); cursor:pointer; display:none; z-index:20
    }
    #musicBtn:hover{ transform:scale(1.06); background:#ff99b3 }

    /* Love Meter */
    #loveFlow{ display:none; z-index:6; margin-top:24px }
    #seriousBox, #meterBox{ display:none; margin-top:14px }
    #meter{ width:90vw; max-width:520px; height:18px; background:#ffe4ee; border-radius:999px; margin:12px auto; position:relative; overflow:hidden; border:1px solid #ffd1e2 }
    #meterFill{ position:absolute; left:0; top:0; bottom:0; width:0%; background:linear-gradient(90deg,#ff9cc6,#ff73a6); box-shadow:0 0 12px rgba(255,115,166,.45) inset; transition:width .3s ease }
    #percentNum{ font-weight:800; color:#ff4f92 }

    /* Confetti hearts */
    .c-heart{
      position:fixed; top:-10px; font-size:18px; animation:fall 3.6s linear forwards; z-index:40; pointer-events:none
    }
    @keyframes fall{ to{ transform:translateY(110vh) rotate(360deg); opacity:.2 } }

    /* Sparkle trail cursor */
    .trail{ position:fixed; pointer-events:none; font-size:14px; opacity:.9; animation:trailFade .8s ease forwards; z-index:30 }
    @keyframes trailFade{ to{ transform:translateY(-10px) scale(1.6); opacity:0 } }

    /* WA form */
    .wa-card{
      display:none; margin-top:22px; background:rgba(255,255,255,.7); border:1px solid #ffd1e2; border-radius:14px; padding:12px; box-shadow:var(--shadow);
      text-align:left; color:#7a5c6d
    }
    .wa-row{ display:flex; gap:10px; margin-top:8px; flex-wrap:wrap }
    .wa-card input, .wa-card textarea{
      flex:1 1 160px; padding:10px 12px; border-radius:10px; border:1px solid #ffc6d9; outline:none; font-size:14px; background:#fff
    }
    .wa-card textarea{ min-height:88px; resize:vertical }
    .wa-actions{ display:flex; gap:8px; align-items:center; margin-top:10px }
    .mini-muted{ font-size:12px; opacity:.75 }

    @media (max-width:420px){
      h1{ font-size:28px }
      #popupInner h2{ font-size:34px }
      .btn{ font-size:16px; padding:12px 16px }
    }
  </style>
</head>
<body>
  <div id="bokeh"></div>
  <div class="wrap">
    <button id="startBtn" class="btn">Klik dulu Liaaa üíñ</button>

    <div id="message"></div>

    <!-- QUOTE: sekarang berisi teks + tombol close, tapi TIDAK dipakai di awal -->
    <div id="quoteBox" role="status" aria-live="polite">
      <div id="quoteBoxInner">
        <span id="quoteText"></span>
        <span id="quoteClose" aria-label="Tutup">√ó</span>
      </div>
    </div>

    <div id="loveQuestion">
      <h1>Do you love me, Liaaa? üò≥üíû</h1>
      <button id="yesBtn" class="btn">Yes üíï</button>
      <button id="noBtn" class="btn runner" style="background:#ffb6c1">No üíî</button>
    </div>

    <div id="fromText">From Rei untuk Liaaa üíå</div>
    <button id="hugBtn" class="btn">Peluk Liaa ü§ó</button>

    <div id="popup">
      <div id="popupInner">
        <h2>I love you Liaaa üíó</h2>
        <p>Liaaa nyaa jangan sakit yaa‚Ä¶ Rei sayang Liaaa selaluuu ü•∫üíû</p>
      </div>
    </div>

    <div id="envelope">üíå</div>

    <!-- Flow lanjutan -->
    <div id="loveFlow">
      <h1>Lia sayang nggak sama Rei? ü•∫</h1>
      <div style="position:relative; min-height:120px">
        <button id="loveYes" class="btn">Iyaa sayang bngtt ü•∫üíû</button>
        <button id="loveMeh" class="btn runner" style="background:#ffb6c1">Biasa aja üòù</button>
      </div>

      <div id="seriousBox">
        <button id="seriousBtn" class="btn">Serius? üò≥</button>
      </div>

      <div id="meterBox">
        <div style="margin-top:10px">Berapa % Lia sayang sama Rei? ü´∂</div>
        <div class="wa-row" style="justify-content:center">
          <input id="percentInput" type="number" min="1" max="100" value="100" style="width:120px; text-align:center"/>
          <button id="setPercent" class="btn">Set</button>
        </div>

        <div id="meter">
          <div id="meterFill"></div>
        </div>
        <div id="percentLabel"><span id="percentNum">0%</span></div>
      </div>

      <!-- Kartu kirim WA -->
      <div id="waCard" class="wa-card">
        <div style="font-weight:700; margin-bottom:6px">Mau ngirim pesan ke rei? üíå</div>
        <div class="wa-row">
          <input id="fbFrom" placeholder="Dari (namamu)" />
          <input id="fbTo"   placeholder="Untuk (namanya)" />
        </div>
        <div class="wa-row">
          <textarea id="fbMsg" placeholder="Tulis pesan untuk rei di sini..."></textarea>
        </div>
        <div class="wa-actions">
          <button id="gbWA" class="btn">Mau ngirim pesan nda syg?</button>
          <span class="mini-muted">nih disini lansgung aja nanti pencet2in yaaa üëå</span>
        </div>
      </div>
    </div>
  </div>

  <button id="musicBtn">üéµ</button>

  <!-- Musik: main & ending mellow -->
  <audio id="bgMusic" loop>
    <source src="https://files.catbox.moe/x3pf5v.mp3" type="audio/mpeg">
  </audio>
  <audio id="endMusic" loop>
    <source src="https://files.catbox.moe/5tvvux.mp3" type="audio/mpeg">
  </audio>

  <script>
    // === KONFIGURASI TUJUAN WHATSAPP ===
    const WA_NUMBER = '6282185719494';

    // Elements
    const startBtn = document.getElementById('startBtn');
    const msg = document.getElementById('message');
    const loveQ = document.getElementById('loveQuestion');
    const yesBtn = document.getElementById('yesBtn');
    const noBtn  = document.getElementById('noBtn');
    const fromTxt = document.getElementById('fromText');
    const hugBtn = document.getElementById('hugBtn');
    const popup = document.getElementById('popup');
    const envelope = document.getElementById('envelope');
    const quoteBox = document.getElementById('quoteBox');
    const quoteText = document.getElementById('quoteText');
    const quoteClose = document.getElementById('quoteClose');
    const musicBtn = document.getElementById('musicBtn');
    const bgMusic = document.getElementById('bgMusic');
    const endMusic = document.getElementById('endMusic');

    const loveFlow = document.getElementById('loveFlow');
    const loveYes = document.getElementById('loveYes');
    const loveMeh = document.getElementById('loveMeh');
    const seriousBox = document.getElementById('seriousBox');
    const seriousBtn = document.getElementById('seriousBtn');
    const meterBox = document.getElementById('meterBox');
    const percentInput = document.getElementById('percentInput');
    const setPercent = document.getElementById('setPercent');
    const meterFill = document.getElementById('meterFill');
    const percentNum = document.getElementById('percentNum');

    const waCard = document.getElementById('waCard');
    const gbWA = document.getElementById('gbWA');
    const fbFrom = document.getElementById('fbFrom');
    const fbTo   = document.getElementById('fbTo');
    const fbMsg  = document.getElementById('fbMsg');

    // Main typing text
    const mainText = "Haloooo Liaa cantikss kamu cantikkk bangeetts dehh membuatt hari2 rei jadi tenang damai bahagia bngttt... semua cape2 ku yg ku genggam rasanya seperti tidak ada apa-apanya semenjak adaa liaa üò≥üíó hehee cuma mau ngasihtau kalau rei syg bngt sama lia hm ü•∫üíû";

    // Quotes (dipakai HANYA DI AKHIR)
    const quotes = [
      "Liaaa nyaa jangan sakit yaa.. ü•∫",
      "Rei sayang Liaaa selaluuu üíû",
      "Lia sayang ga sama Rei? üò≥"
    ];
    let qIdx = 0, qTimer = null;

    function cycleQuotes(){
      quoteBox.style.display = 'flex';
      quoteBox.style.opacity = '1';
      quoteText.textContent = quotes[qIdx % quotes.length];
      qIdx++;
      qTimer = setInterval(()=>{
        quoteText.style.opacity = '0';
        setTimeout(()=>{
          quoteText.textContent = quotes[qIdx % quotes.length];
          qIdx++;
          quoteText.style.opacity = '1';
        }, 350);
      }, 2400);
    }

    if (quoteClose){
      quoteClose.addEventListener('click', ()=>{
        quoteBox.style.opacity = '0';
        setTimeout(()=>{ quoteBox.style.display='none'; }, 300);
        if(qTimer) clearInterval(qTimer);
      });
    }

    function sparkle(el){
      const s = document.createElement('span');
      s.className = 'sparkle';
      s.innerHTML = '‚ú®';
      s.style.left = Math.random()*80+'%';
      s.style.top  = Math.random()*25+'%';
      el.appendChild(s);
      setTimeout(()=>s.remove(),1300);
    }
    function typingEffect(el, txt, speed=45){
      let i=0;
      (function type(){
        if(i<txt.length){
          el.innerHTML += txt.charAt(i);
          if(Math.random()>0.7) sparkle(el);
          i++; setTimeout(type, speed);
        }else{
          setTimeout(()=>{
            loveQ.style.display='block';
            setTimeout(()=> loveQ.style.opacity='1', 80);
          }, 900);
        }
      })();
    }

    function createHearts(){
      const heartTimer = setInterval(()=>{
        const h = document.createElement('div');
        h.className='heart';
        h.style.left = Math.random()*100+'%';
        h.style.animationDuration = (4+Math.random()*2)+'s';
        document.body.appendChild(h);
        setTimeout(()=>h.remove(),6000);
      }, 420);
      setTimeout(()=>clearInterval(heartTimer), 120000);
    }

    document.addEventListener('mousemove', (e)=>{
      const t = document.createElement('div');
      t.className='trail'; t.textContent='‚ú®';
      t.style.left=e.clientX+'px'; t.style.top=e.clientY+'px';
      document.body.appendChild(t);
      setTimeout(()=>t.remove(),800);
    }, {passive:true});

    // START ‚Äî TIDAK lagi memanggil cycleQuotes() di awal
    startBtn.addEventListener('click', ()=>{
      startBtn.style.display='none';
      msg.style.display='block';
      setTimeout(()=> msg.style.opacity='1',100);
      typingEffect(msg, mainText);
      createHearts();
      bgMusic.volume=.35; bgMusic.play().catch(()=>{});
      musicBtn.style.display='block';
      setTimeout(()=> window.scrollTo({top:0, behavior:'smooth'}), 50);
    });

    function moveInsideParent(btn){
      const parent = btn.parentElement || document.body;
      const pRect = parent.getBoundingClientRect();
      const bRect = btn.getBoundingClientRect();
      const maxLeft = Math.max(0, pRect.width - bRect.width - 8);
      const maxTop  = Math.max(0, pRect.height - bRect.height - 8);
      if (pRect.height < 140 && parent === loveQ) parent.style.minHeight = '160px';
      const left = Math.random() * maxLeft;
      const top  = Math.random() * maxTop;
      btn.style.left = Math.round(left) + 'px';
      btn.style.top  = Math.round(top)  + 'px';
    }

    ['mouseenter','touchstart'].forEach(evt=>{
      noBtn.addEventListener(evt, ()=> moveInsideParent(noBtn), {passive:true});
    });

    yesBtn.addEventListener('click', ()=>{
      loveQ.style.animation='shake .4s';
      setTimeout(()=> loveQ.style.animation='', 400);
      loveQ.innerHTML = "<h1>Hehehe aku tau kok Liaa sayang Rei üò≥üíû</h1>";
      setTimeout(()=>{
        fromTxt.style.display='block'; hugBtn.style.display='inline-block';
        setTimeout(()=>{ fromTxt.style.opacity='1'; hugBtn.style.opacity='1'; }, 80);
      }, 1200);
    });

    hugBtn.addEventListener('click', ()=>{
      for(let i=0;i<16;i++){ setTimeout(()=>sparkle(hugBtn), i*70); }
      setTimeout(()=>{ popup.style.display='flex'; envelope.style.display='block'; }, 900);

      setTimeout(()=>{
        popup.style.display='none';
        envelope.style.display='none';
        bgMusic.pause(); endMusic.volume=.35; endMusic.play().catch(()=>{});
        loveFlow.style.display='block';
        fromTxt.style.display='none';
        hugBtn.style.display='none';
        loveQ.style.display='none';
        msg.style.marginBottom = '8px';
        loveFlow.scrollIntoView({behavior:'smooth', block:'start'});
      }, 2800);
    });

    ['mouseenter','touchstart'].forEach(evt=>{
      loveMeh.addEventListener(evt, ()=> moveInsideParent(loveMeh), {passive:true});
    });

    loveYes.addEventListener('click', ()=>{
      seriousBox.style.display='block';
      loveMeh.style.display='none';
      loveYes.disabled = true;
      loveYes.textContent = 'üò≥‚ù§Ô∏è';
      setTimeout(()=> seriousBox.scrollIntoView({behavior:'smooth'}), 50);
    });

    seriousBtn.addEventListener('click', ()=>{
      meterBox.style.display='block';
      seriousBox.style.display='none';
      setTimeout(()=> meterBox.scrollIntoView({behavior:'smooth'}), 50);
    });

    setPercent.addEventListener('click', ()=>{
      let val = parseInt(percentInput.value || '0',10);
      if(isNaN(val) || val<1) val=1;
      if(val>100) val=100;

      let cur=0;
      percentNum.textContent='0%';
      meterFill.style.width='0%';

      const step = () =>{
        if(cur < val){
          cur += Math.ceil(Math.max(1, (val-cur)/20));
          if(cur>val) cur=val;
          percentNum.textContent = cur + '%';
          meterFill.style.width = cur + '%';
          requestAnimationFrame(step);
        }else{
          dropConfetti();
          setTimeout(()=>{
            const endLine = document.createElement('div');
            endLine.style.marginTop='10px';
            endLine.style.color='#ff4f92';
            endLine.style.fontWeight='700';
            endLine.textContent = `Aaaa Liaaa nyaa sayang Rei ${val}%!! üò≠üíó Rei bahagia bangett~`;
            meterBox.appendChild(endLine);

            // === DI SINI BARU MULAI QUOTES & TAMPIL WA CARD ===
            waCard.style.display='block';
            waCard.scrollIntoView({behavior:'smooth'});

            // mulai rotasi quote (AKHIR)
            if(qTimer) clearInterval(qTimer);
            qIdx = 0;
            cycleQuotes();
          }, 350);
        }
      };
      requestAnimationFrame(step);
    });

    function dropConfetti(){
      for(let i=0;i<50;i++){
        setTimeout(()=>{
          const c = document.createElement('div');
          c.className='c-heart';
          c.textContent = ['üíó','üíñ','üíï','üíû'][Math.floor(Math.random()*4)];
          c.style.left = Math.random()*100+'%';
          c.style.fontSize = (16+Math.random()*16)+'px';
          c.style.animationDuration = (2.8+Math.random()*1.6)+'s';
          document.body.appendChild(c);
          setTimeout(()=>c.remove(),3600);
        }, i*35);
      }
    }

    let playing = true;
    musicBtn.addEventListener('click', ()=>{
      const prim = (endMusic.currentTime>0 && !endMusic.paused) ? endMusic : bgMusic;
      if(playing){ prim.pause(); musicBtn.textContent='üîá'; }
      else { prim.play().catch(()=>{}); musicBtn.textContent='üéµ'; }
      playing = !playing;
    });

    let clicks = 0, lastClick = 0;
    document.addEventListener('click', ()=>{
      const now = Date.now();
      if(now - lastClick < 500) clicks++; else clicks=1;
      lastClick = now;
      if(clicks>=3){
        clicks=0;
        const eg = document.createElement('div');
        eg.style.position='fixed'; eg.style.left='50%'; eg.style.top='50%';
        eg.style.transform='translate(-50%,-50%)'; eg.style.background='rgba(255,255,255,.9)';
        eg.style.border='1px solid #ffd1e2'; eg.style.padding='10px 14px'; eg.style.borderRadius='12px';
        eg.style.boxShadow='0 8px 24px rgba(0,0,0,.15)'; eg.style.zIndex=60; eg.style.fontWeight='700';
        eg.textContent='Hehee ketauan deh Liaa nyaa üò≥üíû';
        document.body.appendChild(eg);
        setTimeout(()=> eg.remove(), 1400);
      }
    });

    // === WhatsApp helper ===
    function buildMessage(){
      const from = fbFrom?.value?.trim() || 'Anon';
      const to   = fbTo?.value?.trim()   || 'Lia';
      const note = fbMsg?.value?.trim()  || 'Haii üíó';
      return `Untuk: ${to}\nDari: ${from}\n\nPesan:\n${note}\n\n(Dikirim dari halaman love-letter)`;
    }
    if (gbWA) {
      gbWA.addEventListener('click', () => {
        const payload = buildMessage(); if (!payload) return;
        const url = `https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(payload)}`;
        window.open(url, '_blank');
      });
    }

    window.addEventListener('load', ()=>{
      moveInsideParent(noBtn);
      moveInsideParent(loveMeh);
    }, {once:true});
  </script>
</body>
</html>
